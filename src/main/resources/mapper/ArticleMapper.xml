<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.study.dao.ArticleMapper">
  <resultMap id="BaseResultMap" type="edu.study.model.Article">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 11 10:46:44 CST 2020.
    -->
    <id column="ARTICLE_ID" jdbcType="INTEGER" property="articleId" />
    <result column="USERNAME" jdbcType="VARCHAR" property="username" />
    <result column="CATEGORY_ID" jdbcType="INTEGER" property="categoryId" />
    <result column="TITLE" jdbcType="VARCHAR" property="title" />
    <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
    <result column="MODIFY_TIME" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="CLICKS" jdbcType="INTEGER" property="clicks" />
    <result column="CONTENT" jdbcType="LONGVARCHAR" property="content" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 11 10:46:44 CST 2020.
    -->
    delete from article
    where ARTICLE_ID = #{articleId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="edu.study.model.Article">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 11 10:46:44 CST 2020.
    -->
    insert into article (ARTICLE_ID, USERNAME, CATEGORY_ID, 
      TITLE, CREATE_TIME, MODIFY_TIME, 
      CLICKS, CONTENT)
    values (#{articleId,jdbcType=INTEGER}, #{username,jdbcType=VARCHAR}, #{categoryId,jdbcType=INTEGER}, 
      #{title,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, #{modifyTime,jdbcType=TIMESTAMP}, 
      #{clicks,jdbcType=INTEGER}, #{content,jdbcType=LONGVARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="edu.study.model.Article">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 11 10:46:44 CST 2020.
    -->
    update article
    set USERNAME = #{username,jdbcType=VARCHAR},
      CATEGORY_ID = #{categoryId,jdbcType=INTEGER},
      TITLE = #{title,jdbcType=VARCHAR},
      CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
      CLICKS = #{clicks,jdbcType=INTEGER},
      CONTENT = #{content,jdbcType=LONGVARCHAR}
    where ARTICLE_ID = #{articleId,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 11 10:46:44 CST 2020.
    -->
    select ARTICLE_ID, USERNAME, CATEGORY_ID, TITLE, CREATE_TIME, MODIFY_TIME, CLICKS, 
    CONTENT
    from article
    where ARTICLE_ID = #{articleId,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 11 10:46:44 CST 2020.
    -->
    select ARTICLE_ID, USERNAME, CATEGORY_ID, TITLE, CREATE_TIME, MODIFY_TIME, CLICKS, 
    CONTENT
    from article
  </select>


  <insert id="insertAndGetId" keyProperty="articleId" parameterType="edu.study.model.Article" useGeneratedKeys="true">
    insert into article (USERNAME, CATEGORY_ID,
      TITLE, CREATE_TIME, MODIFY_TIME,
      CLICKS, CONTENT)
    values (#{username,jdbcType=VARCHAR}, #{categoryId,jdbcType=INTEGER},
      #{title,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, #{modifyTime,jdbcType=TIMESTAMP},
      #{clicks,jdbcType=INTEGER}, #{content,jdbcType=LONGVARCHAR})
  </insert>



  <select id="articleCountByCategoryId" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select count(*) from article where CATEGORY_ID = #{categoryId,jdbcType=INTEGER}
  </select>
  <select id="articleCountByCategoryIdUsername" resultType="java.lang.Integer">
    select count(*) from article
    where CATEGORY_ID = #{categoryId,jdbcType=INTEGER}
    and USERNAME = #{username,jdbcType=VARCHAR}
  </select>
  <select id="articleCountByCategoryIdCollect" resultType="java.lang.Integer">
    select count(*)
    from article inner join article_collection
    on article.article_id = article_collection.article_id
    where CATEGORY_ID = #{categoryId,jdbcType=INTEGER}
    and article_collection.username = #{username,jdbcType=VARCHAR}
  </select>


  <select id="selectByPageLimit" parameterType="Map" resultMap="BaseResultMap">
    select ARTICLE_ID, USERNAME, CATEGORY_ID, TITLE, CREATE_TIME, MODIFY_TIME, CLICKS,
    CONTENT
    from article
    where CATEGORY_ID = #{categoryId,jdbcType=INTEGER}
    limit #{start,jdbcType=INTEGER},#{size,jdbcType=INTEGER}
  </select>
  <select id="selectByPageLimitUsername" parameterType="Map" resultMap="BaseResultMap">
    select ARTICLE_ID, USERNAME, CATEGORY_ID, TITLE, CREATE_TIME, MODIFY_TIME, CLICKS,
    CONTENT
    from article
    where CATEGORY_ID = #{categoryId,jdbcType=INTEGER}
    and USERNAME = #{username,jdbcType=VARCHAR}
    limit #{start,jdbcType=INTEGER},#{size,jdbcType=INTEGER}
  </select>
  <select id="selectByPageLimitCollect" parameterType="Map" resultMap="BaseResultMap">
    select article.ARTICLE_ID, article.USERNAME, CATEGORY_ID, TITLE, CREATE_TIME, MODIFY_TIME, CLICKS,
    CONTENT
    from article inner join article_collection
    on article.article_id = article_collection.article_id
    where CATEGORY_ID = #{categoryId,jdbcType=INTEGER}
    and article_collection.username = #{username,jdbcType=VARCHAR}
    limit #{start,jdbcType=INTEGER},#{size,jdbcType=INTEGER}
  </select>




  <update id="updateArticleClicks" parameterType="java.lang.Integer">
    update article set CLICKS = CLICKS + 1 where ARTICLE_ID = #{articleId,jdbcType=INTEGER}
  </update>

  <select id="selectByModifyTime" parameterType="java.util.Date" resultMap="BaseResultMap">
    select ARTICLE_ID, USERNAME, CATEGORY_ID, TITLE, CREATE_TIME, MODIFY_TIME, CLICKS,
    CONTENT
    from article
    where MODIFY_TIME > #{date,jdbcType=TIMESTAMP}
  </select>

  <select id="countAll" resultType="java.lang.Integer">
    select count(*) from article
  </select>

  <select id="countLike" parameterType="java.lang.String" resultType="java.lang.Integer">
    select count(*) from article where title like #{str,jdbcType=VARCHAR} or content like #{str,jdbcType=VARCHAR}
  </select>

  <select id="selectByclicks" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select ARTICLE_ID, USERNAME, CATEGORY_ID, TITLE, CREATE_TIME, MODIFY_TIME, CLICKS,
    CONTENT
    from article
    order by CLICKS DESC
    limit 0,#{size,jdbcType=INTEGER}
  </select>

  <select id="countByAuthor" parameterType="java.lang.String" resultType="java.lang.Integer">
    select count(*)
    from article
    where username = #{username,jdbcType=VARCHAR}
  </select>

  <select id="countByCollect" parameterType="java.lang.String" resultType="java.lang.Integer">
    select count(*)
    from article inner join article_collection
    on article.article_id = article_collection.article_id
    where article_collection.username = #{username,jdbcType=VARCHAR}
  </select>
</mapper>